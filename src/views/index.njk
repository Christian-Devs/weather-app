{%extends "layout.njk" %}
{% block content %}
<div class="row">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-body">
                <h5 class="card-title">Get Local Weather</h5>
                <form method="get" action="/" class="mb-2" id="address-form">
                    <div class="form-group mb-2">
                        <label for="address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="address" name="address" placeholder="Enter address" required>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="btn-fetch-js" type="button">Get Weather(AJAX)</button>
                        <button class="btn btn-warning" type="submit">Get Weather (Form GET)</button>
                        <button class="btn btn-success" id="btn-save" type="button" disabled>Save Weather</button>
                        <button class="btn btn-info" id="btn-history" type="button">View History</button>
                    </div>
                </form>
                <div id="weather-result" class="mt-3"></div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-body">
                <h5 class="card-title">Saved Weather History</h5>
                <div id="history-result" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>

{% if error %}
<div class="alert alert-danger mt-3" role="alert">{{error}}</div>
{% endif %}

{% if initial %}
  <div id="initial-data" data-json='{{ initial | tojson | safe }}'></div>
  <script>
    (function(){
      const el = document.getElementById("initial-data");
      try {
        window.__INITIAL__ = JSON.parse(el.dataset.json);
      } catch (e) {
        console.error("Failed to parse initial JSON:", e);
        window.__INITIAL__ = null;
      }
    })();
  </script>
{% else %}
  <script>window.__INITIAL__ = null;</script>
{% endif %}


{% endblock %}
    
